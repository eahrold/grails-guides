<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>3 Writing the Application</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/guide.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />            
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <div class="navTitle">
        
        Grails Framework Guide 
    </div>
    <div class="navLinks">
        <ul>
            <li>
                <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                    <a href="../guide/index.html" class="button">Table of contents</a>

                    <div id="nav-summary-childs" style="display:none;">
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/training.html"><strong>1</strong><span>Grails Training</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/gettingStarted.html"><strong>2</strong><span>Getting Started</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/writingTheApp.html"><strong>3</strong><span>Writing the Application</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/runningTheApp.html"><strong>4</strong><span>Running the Application</span></a>
                        </div>
                        
                        <div class="toc-item" style="margin-left:0"><a href="../guide/helpWithGrails.html"><strong>5</strong><span>Help with Grails</span></a>
                        </div>
                        
                    </div>
                </div>
            </li>
        </ul>
    </div>


</div>

<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/gettingStarted.html">&lt;&lt; <strong>2</strong><span>Getting Started</span></a></div>
                

                
                    <div class="toc-item next-right"><a href="../guide/runningTheApp.html"><strong>4</strong><span>Running the Application</span> >></a></div>
                


                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#openweather"><strong>3.1</strong><span>Open Weather Map</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#pogos"><strong>3.2</strong><span>Parse Response into Groovy classes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#service"><strong>3.3</strong><span>Open Weather Service</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#parse"><strong>3.4</strong><span>Parse Response into Groovy Classes</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#ersatz"><strong>3.5</strong><span>Ersatz</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#testapp"><strong>3.6</strong><span>Run Tests</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#controller"><strong>3.7</strong><span>Root Url to Weather Controller</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#taglib"><strong>3.8</strong><span>TagLib</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#view"><strong>3.9</strong><span>View</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="writingTheApp">3 Writing the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/grails3/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>The first step is to add a HTTP client library to our project. Add the next dependency:</p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    compile <span class="string"><span class="delimiter">&quot;</span><span class="content">org.grails:grails-datastore-rest-client</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>


<h2 id="openweather">3.1 Open Weather Map</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/grails3/src/main/docs/guide/openweather.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><a href="https://openweathermap.org">OpenWeatherMap</a> is a web application which offers an API which allows you to:</p>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Get current weather, daily forecast for 16 days, and 3-hourly forecast 5 days for your city. Helpful stats, graphics, and this day in history charts are available for your reference. Interactive maps show precipitation, clouds, pressure, wind around your location.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>They have a FREE plan which allows you to get the <a href="https://openweathermap.org/current">Current Weather Data</a> of a city.</p>
</div>
<div class="paragraph">
<p>After you register, you get an API Key. You will need an API key to interact with the Open Weather Map API.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="../img/apiKey.png" alt="apiKey">
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
the API key may take several minutes to become active.
</td>
</tr>
</table>
</div>


<h2 id="pogos">3.2 Parse Response into Groovy classes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/grails3/src/main/docs/guide/pogos.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create several Groovy POGOs (Plain Old Groovy Objects) to map the <code>OpenWeatherMap</code> JSON response to classes.</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/org/openweathermap/CurrentWeather.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">CurrentWeather</span> {
    Main main
    Coordinate coordinate
    <span class="predefined-type">List</span>&lt;Weather&gt; weatherList
    Wind wind
    Sys sys
    Rain rain
    Clouds clouds
    <span class="predefined-type">String</span> base
    <span class="predefined-type">Integer</span> dt
    <span class="predefined-type">Long</span> cityId
    <span class="predefined-type">String</span> cityName
    <span class="predefined-type">Integer</span> code
    <span class="predefined-type">Integer</span> visibility
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/org/openweathermap/Clouds.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="type">class</span> <span class="class">Clouds</span> {
    <span class="predefined-type">Integer</span> cloudiness
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/org/openweathermap/Coordinate.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">Coordinate</span> {
    <span class="predefined-type">BigDecimal</span> longitude
    <span class="predefined-type">BigDecimal</span> latitude

}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/org/openweathermap/Rain.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">Rain</span> {
    <span class="predefined-type">Integer</span> lastThreeHours
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/org/openweathermap/Unit.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">enum</span> Unit {
    Standard, Imperial, Metric

    <span class="directive">static</span> Unit unitWithString(<span class="predefined-type">String</span> str) {
        <span class="keyword">if</span> ( str ) {
            <span class="keyword">if</span> ( str.toLowerCase() == <span class="string"><span class="delimiter">'</span><span class="content">metric</span><span class="delimiter">'</span></span> ) {
                <span class="keyword">return</span> Unit.Metric
            } <span class="keyword">else</span> <span class="keyword">if</span> ( str.toLowerCase() == <span class="string"><span class="delimiter">'</span><span class="content">imperial</span><span class="delimiter">'</span></span> ) {
                <span class="keyword">return</span> Unit.Imperial
            }
        }
        Unit.Standard
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/org/openweathermap/Weather.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">Weather</span> {
    <span class="predefined-type">Long</span> id
    <span class="predefined-type">String</span> main
    <span class="predefined-type">String</span> description
    <span class="predefined-type">String</span> icon
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/org/openweathermap/Sys.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">Sys</span> {
    <span class="predefined-type">Long</span> id
    <span class="predefined-type">String</span> type
    <span class="predefined-type">String</span> message
    <span class="predefined-type">String</span> country
    <span class="predefined-type">Integer</span> sunrise
    <span class="predefined-type">Integer</span> sunset
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/org/openweathermap/Wind.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">Wind</span> {
    <span class="predefined-type">BigDecimal</span> speed
    <span class="predefined-type">BigDecimal</span> deg
}</code></pre>
</div>
</div>


<h2 id="service">3.3 Open Weather Service</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/grails3/src/main/docs/guide/service.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create the next service:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/services/org/openweathermap/OpenweathermapService.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="keyword">import</span> <span class="include">grails.config.Config</span>
<span class="keyword">import</span> <span class="include">grails.core.support.GrailsConfigurationAware</span>
<span class="keyword">import</span> <span class="include">grails.plugins.rest.client.RestBuilder</span>
<span class="keyword">import</span> <span class="include">grails.plugins.rest.client.RestResponse</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileDynamic</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">OpenweathermapService</span> <span class="directive">implements</span> GrailsConfigurationAware {
    <span class="predefined-type">String</span> appid
    <span class="predefined-type">String</span> cityName
    <span class="predefined-type">String</span> countryCode
    <span class="predefined-type">String</span> openWeatherUrl

    <span class="annotation">@Override</span>
    <span class="type">void</span> setConfiguration(Config co) {
        openWeatherUrl = co.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">openweather.url</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>, <span class="string"><span class="delimiter">'</span><span class="content">http://api.openweathermap.org</span><span class="delimiter">'</span></span>)
        appid = co.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">openweather.appid</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
        cityName = co.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">openweather.cityName</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
        countryCode = co.getProperty(<span class="string"><span class="delimiter">'</span><span class="content">openweather.countryCode</span><span class="delimiter">'</span></span>, <span class="predefined-type">String</span>)
    }
    <span class="annotation">@CompileDynamic</span>
    CurrentWeather currentWeather(Unit units = Unit.Standard) {
        currentWeather(cityName, countryCode, units)
    }


    <span class="annotation">@CompileDynamic</span>
    CurrentWeather currentWeather(<span class="predefined-type">String</span> cityName, <span class="predefined-type">String</span> countryCode, Unit unit = Unit.Standard) {
        RestBuilder rest = <span class="keyword">new</span> RestBuilder()
        <span class="predefined-type">String</span> url = <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>openWeatherUrl<span class="inline-delimiter">}</span></span><span class="content">/data/2.5/weather?q={city},{countryCode}&amp;appid={appid}</span><span class="delimiter">&quot;</span></span>
        <span class="predefined-type">Map</span> params = [<span class="key">city</span>: cityName, <span class="key">countryCode</span>: countryCode, <span class="key">appid</span>: appid]
        <span class="predefined-type">String</span> unitParam = unitParameter(unit)
        <span class="keyword">if</span> ( unitParam ) {
            params.units = unitParam
            url += <span class="string"><span class="delimiter">&quot;</span><span class="content">&amp;units={units}</span><span class="delimiter">&quot;</span></span>
        }
        RestResponse restResponse = rest.get(url) { <i class="conum" data-value="1"></i><b>(1)</b>
            urlVariables params
        }

        <span class="keyword">if</span> ( restResponse.statusCode.value() == <span class="integer">200</span> &amp;&amp; restResponse.json ) {
            <span class="keyword">return</span> OpenweathermapParser.currentWeatherFromJSONElement(restResponse.json) <i class="conum" data-value="2"></i><b>(2)</b>
        }
        <span class="predefined-constant">null</span> <i class="conum" data-value="3"></i><b>(3)</b>
    }

  <span class="comment">/**
    * @return null if Standard Unit
    */</span>
    <span class="predefined-type">String</span> unitParameter(Unit unit)  {
        <span class="keyword">switch</span> ( unit ) {
            <span class="keyword">case</span> Unit.Metric:
                <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">metric</span><span class="delimiter">'</span></span>
            <span class="keyword">case</span> Unit.Imperial:
                <span class="keyword">return</span> <span class="string"><span class="delimiter">'</span><span class="content">imperial</span><span class="delimiter">'</span></span>
            <span class="keyword">default</span>:
                <span class="keyword">return</span> <span class="predefined-constant">null</span>
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>To get the current weather, do a GET request providing the city name, country code and API Key as query parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>In case of a 200 - OK - response, parse the JSON data into Groovy classes.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>if the answer is not 200. For example, 401; the method returns null.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The previous service uses several configuration parameters. Define them in <code>application.yml</code></p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="yaml"><span class="key">openweather</span>:
    <span class="key">appid</span>: <span class="string"><span class="content">1f6c7d09a28f1ddccf70c06e2cb75ee4</span></span>
    <span class="key">cityName</span>: <span class="string"><span class="content">London</span></span>
    <span class="key">countryCode</span>: <span class="string"><span class="content">uk</span></span></code></pre>
</div>
</div>


<h2 id="parse">3.4 Parse Response into Groovy Classes</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/grails3/src/main/docs/guide/parse.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create the next class to encapsulte the parsing of JSON payload into Groovy Classes.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/utils/org/openweathermap/OpenweathermapParser.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>
<span class="keyword">import</span> <span class="include">org.grails.web.json.JSONElement</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileDynamic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">OpenweathermapParser</span>  {

    <span class="annotation">@CompileDynamic</span>
    <span class="directive">static</span> Coordinate coordinateFromJsonElement(JSONElement json) {
        Coordinate coordinate = <span class="keyword">new</span> Coordinate()
        <span class="keyword">if</span> ( json.long ) {
            coordinate.longitude = json.long <span class="keyword">as</span> <span class="predefined-type">BigDecimal</span>
        }
        <span class="keyword">if</span> ( json.lat ) {
            coordinate.latitude = json.lat <span class="keyword">as</span> <span class="predefined-type">BigDecimal</span>
        }
        coordinate
    }

    <span class="annotation">@CompileDynamic</span>
    <span class="directive">static</span> Main mainFromJsonElement(JSONElement json) {
        Main main = <span class="keyword">new</span> Main()
        <span class="keyword">if</span> ( json.temp ) {
            main.temperature = json.temp <span class="keyword">as</span> <span class="predefined-type">BigDecimal</span>
        }
        <span class="keyword">if</span> ( json.pressure ) {
            main.pressure = json.pressure <span class="keyword">as</span> <span class="predefined-type">BigDecimal</span>
        }
        <span class="keyword">if</span> ( json.humidity ) {
            main.humidity = json.humidity <span class="keyword">as</span> <span class="predefined-type">Integer</span>
        }
        <span class="keyword">if</span> ( json.temp_min ) {
            main.tempMin = json.temp_min <span class="keyword">as</span> <span class="predefined-type">BigDecimal</span>
        }
        <span class="keyword">if</span> ( json.temp_max ) {
            main.tempMax = json.temp_max <span class="keyword">as</span> <span class="predefined-type">BigDecimal</span>
        }
        <span class="keyword">if</span> ( json.seaLevel ) {
            main.seaLevel = json.seaLevel <span class="keyword">as</span> <span class="predefined-type">BigDecimal</span>
        }
        <span class="keyword">if</span> ( json.groundLevel ) {
            main.groundLevel = json.groundLevel <span class="keyword">as</span> <span class="predefined-type">BigDecimal</span>
        }
        main
    }

    <span class="annotation">@CompileDynamic</span>
    <span class="directive">static</span> Wind windFromJsonElement(JSONElement json) {
        Wind wind = <span class="keyword">new</span> Wind()
        <span class="keyword">if</span> ( json.speed ) {
            wind.speed = json.speed <span class="keyword">as</span> <span class="predefined-type">BigDecimal</span>
        }
        <span class="keyword">if</span> ( json.deg ) {
            wind.deg = json.deg <span class="keyword">as</span> <span class="predefined-type">BigDecimal</span>
        }
        wind
    }

    <span class="annotation">@CompileDynamic</span>
    <span class="directive">static</span> Sys sysFromJsonElement(JSONElement json) {
        Sys sys = <span class="keyword">new</span> Sys()
        <span class="keyword">if</span> ( json.id ) {
            sys.id = json.id <span class="keyword">as</span> <span class="predefined-type">Long</span>
        }
        <span class="keyword">if</span> ( json.type ) {
            sys.type = json.type
        }
        <span class="keyword">if</span> ( json.message ) {
            sys.message = json.message
        }
        <span class="keyword">if</span> ( json.country ) {
            sys.country = json.country
        }
        <span class="keyword">if</span> ( json.sunrise ) {
            sys.sunrise = json.sunrise <span class="keyword">as</span> <span class="predefined-type">Integer</span>
        }
        <span class="keyword">if</span> ( json.sunset ) {
            sys.sunset = json.sunset <span class="keyword">as</span> <span class="predefined-type">Integer</span>
        }
        sys
    }

    <span class="annotation">@CompileDynamic</span>
    <span class="directive">static</span> Weather weatherFromJsonElement(JSONElement json) {
        Weather weather = <span class="keyword">new</span> Weather()
        <span class="keyword">if</span> ( json.id ) {
            weather.id = json.id <span class="keyword">as</span> <span class="predefined-type">Long</span>
        }
        <span class="keyword">if</span> ( json.main ) {
            weather.main = json.main
        }
        <span class="keyword">if</span> ( json.description ) {
            weather.description = json.description
        }
        <span class="keyword">if</span> ( json.icon ) {
            weather.icon = json.icon
        }
        weather
    }

    <span class="annotation">@CompileDynamic</span>
    <span class="directive">static</span> CurrentWeather currentWeatherFromJSONElement(JSONElement json) {
        CurrentWeather currentWeather = <span class="keyword">new</span> CurrentWeather()

        <span class="keyword">if</span> ( json.coord ) {
            currentWeather.coordinate = coordinateFromJsonElement(json.coord)
        }
        <span class="keyword">if</span> ( json.main ) {
            currentWeather.main = mainFromJsonElement(json.main)
        }
        <span class="keyword">if</span> ( json.wind ) {
            currentWeather.wind = windFromJsonElement(json.wind)
        }
        <span class="keyword">if</span> ( json.clouds ) {
            currentWeather.clouds = <span class="keyword">new</span> Clouds()
            <span class="keyword">if</span> ( json.clouds.all ) {
                currentWeather.clouds.cloudiness = json.clouds.all <span class="keyword">as</span> <span class="predefined-type">Integer</span>
            }
        }
        <span class="keyword">if</span> ( json.sys ) {
            currentWeather.sys = sysFromJsonElement(json.sys)
        }
        <span class="keyword">if</span> ( json.id ) {
            currentWeather.cityId = json.id <span class="keyword">as</span> <span class="predefined-type">Long</span>
        }
        <span class="keyword">if</span> ( json.base ) {
            currentWeather.base = json.base
        }
        <span class="keyword">if</span> ( json.name ) {
            currentWeather.cityName = json.name
        }
        <span class="keyword">if</span> ( json.cod ) {
            currentWeather.code = json.cod <span class="keyword">as</span> <span class="predefined-type">Integer</span>
        }
        <span class="keyword">if</span> ( json.visibility ) {
            currentWeather.visibility = json.visibility
        }
        <span class="keyword">if</span> ( json.dt ) {
            currentWeather.dt = json.dt <span class="keyword">as</span> <span class="predefined-type">Integer</span>
        }

        <span class="keyword">if</span> ( json.weather ) {
            currentWeather.weatherList = <span class="type">[]</span>
            <span class="keyword">for</span> ( <span class="predefined-type">Object</span> obj : json.weather ) {
                Weather weather = weatherFromJsonElement(obj)
                currentWeather.weatherList &lt;&lt; weather
            }
        }
        currentWeather
    }
}</code></pre>
</div>
</div>


<h2 id="ersatz">3.5 Ersatz</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/grails3/src/main/docs/guide/ersatz.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To test the networking code, add a dependency to <a href="http://stehno.com/ersatz/">Ersatz</a></p>
</div>
<div class="listingblock">
<div class="title">build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    testCompile <span class="string"><span class="delimiter">'</span><span class="content">com.stehno.ersatz:ersatz:1.5.0</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="quoteblock">
<blockquote>
<div class="paragraph">
<p>Ersatz Server is a "mock" HTTP server library for testing HTTP clients. It allows for server-side request/response expectations to be configured so that your client library can make real HTTP calls and get back real pre-configured responses rather than fake stubs.</p>
</div>
</blockquote>
</div>
<div class="paragraph">
<p>First, implement a test which verifies that the <code>OpenweathermapService.currentWeather</code> method returns
null when the REST API returns <code>401</code>. For example, when the API Key is invalid.</p>
</div>
<div class="listingblock">
<div class="title">src/test/groovy/org/openweathermap/OpenweathermapServiceSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="keyword">import</span> <span class="include">com.stehno.ersatz.ContentType</span>
<span class="keyword">import</span> <span class="include">com.stehno.ersatz.Encoders</span>
<span class="keyword">import</span> <span class="include">com.stehno.ersatz.ErsatzServer</span>
<span class="keyword">import</span> <span class="include">grails.testing.services.ServiceUnitTest</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="type">class</span> <span class="class">OpenweathermapServiceSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> ServiceUnitTest&lt;OpenweathermapService&gt; {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">For an unauthorized key, null is return</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        ErsatzServer ersatz = <span class="keyword">new</span> ErsatzServer()
        <span class="predefined-type">String</span> city = <span class="string"><span class="delimiter">'</span><span class="content">London</span><span class="delimiter">'</span></span>
        <span class="predefined-type">String</span> countryCode = <span class="string"><span class="delimiter">'</span><span class="content">uk</span><span class="delimiter">'</span></span>
        <span class="predefined-type">String</span> appid = <span class="string"><span class="delimiter">'</span><span class="content">XXXXX</span><span class="delimiter">'</span></span>
        ersatz.expectations {
            get(<span class="string"><span class="delimiter">'</span><span class="content">/data/2.5/weather</span><span class="delimiter">'</span></span>) { <i class="conum" data-value="1"></i><b>(1)</b>
                query(<span class="string"><span class="delimiter">'</span><span class="content">q</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>city<span class="inline-delimiter">}</span></span><span class="content">,</span><span class="inline"><span class="inline-delimiter">${</span>countryCode<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
                query(<span class="string"><span class="delimiter">'</span><span class="content">appid</span><span class="delimiter">'</span></span>, appid)
                called(<span class="integer">1</span>) <i class="conum" data-value="2"></i><b>(2)</b>
                responder {
                    code(<span class="integer">401</span>) <i class="conum" data-value="3"></i><b>(3)</b>
                }
            }
        }
        service.openWeatherUrl = ersatz.httpUrl <i class="conum" data-value="4"></i><b>(4)</b>
        service.appid = appid

        <span class="key">when</span>:
        CurrentWeather currentWeather = service.currentWeather(city, countryCode)

        <span class="key">then</span>:
        !currentWeather

        <span class="key">and</span>:
        ersatz.verify() <i class="conum" data-value="5"></i><b>(5)</b>

        <span class="key">cleanup</span>:
        ersatz.stop() <i class="conum" data-value="6"></i><b>(6)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declare expectations, a GET request to the <code>OpenWeather</code> path with query parameters.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Declare conditions to be verified, in this example we want to to verify the endpoint is hit only one time.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Tell the mock server to return 401 for this test.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Ersatz starts an embedded Undertow server, root the networking requests to this server instead of to the OpenWeather API server.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Verify the ersatz servers conditions.</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Rember to stop the server</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Next, test that when the server returns 200 and a JSON payload, the JSON payload is parsed correctly into Groovy classes.</p>
</div>
<div class="listingblock">
<div class="title">src/test/groovy/org/openweathermap/OpenweathermapServiceSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="keyword">import</span> <span class="include">com.stehno.ersatz.ContentType</span>
<span class="keyword">import</span> <span class="include">com.stehno.ersatz.Encoders</span>
<span class="keyword">import</span> <span class="include">com.stehno.ersatz.ErsatzServer</span>
<span class="keyword">import</span> <span class="include">grails.testing.services.ServiceUnitTest</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>

<span class="type">class</span> <span class="class">OpenweathermapServiceSpec</span> <span class="directive">extends</span> Specification <span class="directive">implements</span> ServiceUnitTest&lt;OpenweathermapService&gt; {

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">A CurrentWeather object is built from JSON Payload</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">given</span>:
        ErsatzServer ersatz = <span class="keyword">new</span> ErsatzServer()
        <span class="predefined-type">String</span> city = <span class="string"><span class="delimiter">'</span><span class="content">London</span><span class="delimiter">'</span></span>
        <span class="predefined-type">String</span> countryCode = <span class="string"><span class="delimiter">'</span><span class="content">uk</span><span class="delimiter">'</span></span>
        <span class="predefined-type">String</span> appid = <span class="string"><span class="delimiter">'</span><span class="content">XXXXX</span><span class="delimiter">'</span></span>
        ersatz.expectations {
            get(<span class="string"><span class="delimiter">'</span><span class="content">/data/2.5/weather</span><span class="delimiter">'</span></span>) {
                query(<span class="string"><span class="delimiter">'</span><span class="content">q</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>city<span class="inline-delimiter">}</span></span><span class="content">,</span><span class="inline"><span class="inline-delimiter">${</span>countryCode<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>)
                query(<span class="string"><span class="delimiter">'</span><span class="content">appid</span><span class="delimiter">'</span></span>, appid)
                called(<span class="integer">1</span>)
                responder {
                    encoder(ContentType.APPLICATION_JSON, <span class="predefined-type">Map</span>, Encoders.json) <i class="conum" data-value="1"></i><b>(1)</b>
                    code(<span class="integer">200</span>)
                    content([
                        coord     : [<span class="key">lon</span>: -<span class="float">0.13</span>, <span class="key">lat</span>: <span class="float">51.51</span>],
                        weather   : [[<span class="key">id</span>: <span class="integer">803</span>, <span class="key">main</span>: <span class="string"><span class="delimiter">'</span><span class="content">Clouds</span><span class="delimiter">'</span></span>, <span class="key">description</span>: <span class="string"><span class="delimiter">'</span><span class="content">broken clouds</span><span class="delimiter">'</span></span>, <span class="key">icon</span>: <span class="string"><span class="delimiter">'</span><span class="content">04d</span><span class="delimiter">'</span></span>]],
                        base      : <span class="string"><span class="delimiter">'</span><span class="content">stations</span><span class="delimiter">'</span></span>,
                        main      : [<span class="key">temp</span>: <span class="float">20.81</span>, <span class="key">pressure</span>: <span class="integer">1017</span>, <span class="key">humidity</span>: <span class="integer">53</span>, <span class="key">temp_min</span>: <span class="integer">19</span>, <span class="key">temp_max</span>: <span class="integer">22</span>],
                        <span class="key">visibility</span>: <span class="integer">10000</span>,
                        wind      : [<span class="key">speed</span>: <span class="float">3.6</span>, <span class="key">deg</span>: <span class="integer">180</span>, <span class="key">gust</span>: <span class="float">9.8</span>],
                        clouds    : [<span class="key">all</span>: <span class="integer">75</span>],
                        dt        : <span class="integer">1502707800</span>,
                        sys       : [<span class="key">type</span>: <span class="integer">1</span>, <span class="key">id</span>: <span class="integer">5091</span>, <span class="key">message</span>: <span class="float">0.0029</span>, <span class="key">country</span>: <span class="string"><span class="delimiter">&quot;</span><span class="content">GB</span><span class="delimiter">&quot;</span></span>, <span class="key">sunrise</span>: <span class="integer">1502685920</span>, <span class="key">sunset</span>: <span class="integer">1502738622</span>],
                        id        : <span class="integer">2643743</span>,
                        name      : <span class="string"><span class="delimiter">'</span><span class="content">London</span><span class="delimiter">'</span></span>,
                        cod       : <span class="integer">200</span>
                    ], ContentType.APPLICATION_JSON) <i class="conum" data-value="2"></i><b>(2)</b>
                }
            }
        }
        service.openWeatherUrl = ersatz.httpUrl
        service.appid = appid

        <span class="key">when</span>:
        CurrentWeather currentWeather = service.currentWeather(city, countryCode)

        <span class="key">then</span>:
        currentWeather
        currentWeather.weatherList[<span class="integer">0</span>].main == <span class="string"><span class="delimiter">'</span><span class="content">Clouds</span><span class="delimiter">'</span></span>
        currentWeather.cityName == <span class="string"><span class="delimiter">'</span><span class="content">London</span><span class="delimiter">'</span></span>
        currentWeather.code == <span class="integer">200</span>
        currentWeather.cityId == <span class="integer">2643743</span>
        currentWeather.main.temperature == <span class="float">20.81</span>
        currentWeather.main.pressure == <span class="integer">1017</span>
        currentWeather.main.humidity == <span class="integer">53</span>
        currentWeather.main.tempMin == <span class="integer">19</span>
        currentWeather.main.tempMax == <span class="integer">22</span>
        currentWeather.weatherList[<span class="integer">0</span>].id == <span class="integer">803</span>
        currentWeather.weatherList[<span class="integer">0</span>].main == <span class="string"><span class="delimiter">'</span><span class="content">Clouds</span><span class="delimiter">'</span></span>
        currentWeather.weatherList[<span class="integer">0</span>].description == <span class="string"><span class="delimiter">'</span><span class="content">broken clouds</span><span class="delimiter">'</span></span>
        currentWeather.weatherList[<span class="integer">0</span>].icon == <span class="string"><span class="delimiter">'</span><span class="content">04d</span><span class="delimiter">'</span></span>
        currentWeather.visibility == <span class="integer">10000</span>
        currentWeather.wind.speed == <span class="float">3.6</span>
        currentWeather.wind.deg == <span class="integer">180</span>
        currentWeather.clouds.cloudiness == <span class="integer">75</span>
        currentWeather.base == <span class="string"><span class="delimiter">'</span><span class="content">stations</span><span class="delimiter">'</span></span>
        currentWeather.dt == <span class="integer">1502707800</span>
        currentWeather.coordinate

        <span class="key">and</span>:
        ersatz.verify()

        <span class="key">cleanup</span>:
        ersatz.stop()
    }

}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>Declare a response encoder to convert a <code>Map</code> into <code>application/json</code> content using an Ersatz-provided encoder.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Define the response content as a <code>Map</code> which will be converted to JSON by the defined encoder (above).</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
As of Ersatz version 1.5.0 the internal Undertow embedded server version is out of sync with Grails. If you use Undertow as your server for Grails you may have classpath collisions or odd errors. This can be avoided by using the "safe" (shadowed) version of the Ersatz dependency (see the <a href="http://stehno.com/ersatz/asciidoc/html5/#_shadow_jar">Shadow Jar section of the Ersatz User Guide</a> for more details).
</td>
</tr>
</table>
</div>


<h2 id="testapp">3.6 Run Tests</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/grails3/src/main/docs/guide/testapp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To run the tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./grailsw
grails&gt; test-app
grails&gt; open test-report</code></pre>
</div>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./gradlew check
open build/reports/tests/index.html</code></pre>
</div>
</div>


<h2 id="controller">3.7 Root Url to Weather Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/grails3/src/main/docs/guide/controller.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create a <code>HomeController</code> which uses the previous service:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/demo/HomeController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> demo

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>
<span class="keyword">import</span> <span class="include">org.openweathermap.CurrentWeather</span>
<span class="keyword">import</span> <span class="include">org.openweathermap.OpenweathermapService</span>
<span class="keyword">import</span> <span class="include">org.openweathermap.Unit</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">HomeController</span> {
    OpenweathermapService openweathermapService

    <span class="keyword">def</span> <span class="function">index</span>(<span class="predefined-type">String</span> unit) {
        Unit unitEnum = Unit.unitWithString(unit)
        CurrentWeather currentWeather = openweathermapService.currentWeather(unitEnum)
        [<span class="key">currentWeather</span>: currentWeather, <span class="key">unit</span>: unitEnum]
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>In <code>UrlMapping.groovy</code> map the root URL to this controller:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">&quot;</span><span class="content">/</span><span class="delimiter">&quot;</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">home</span><span class="delimiter">'</span></span>)<span class="error">`</span></code></pre>
</div>
</div>


<h2 id="taglib">3.8 TagLib</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/grails3/src/main/docs/guide/taglib.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create a taglib to help you, to encapsulate some rendering aspects:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/taglib/org/openweathermap/OpenweathermapTagLib.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> org.openweathermap

<span class="type">class</span> <span class="class">OpenweathermapTagLib</span> {
    <span class="directive">static</span> namespace = <span class="string"><span class="delimiter">&quot;</span><span class="content">openweather</span><span class="delimiter">&quot;</span></span>

    <span class="keyword">def</span> image = { attrs -&gt;
        out &lt;&lt; <span class="string"><span class="delimiter">&quot;</span><span class="content">&lt;img src=</span><span class="char">\&quot;</span><span class="content">http://openweathermap.org/img/w/</span><span class="inline"><span class="inline-delimiter">${</span>attrs.icon<span class="inline-delimiter">}</span></span><span class="content">.png</span><span class="char">\&quot;</span><span class="content">/&gt;</span><span class="delimiter">&quot;</span></span>
    }

    <span class="keyword">def</span> temperatureSymbol = { attrs -&gt;
        <span class="keyword">if</span> ( attrs.unit == Unit.Imperial ) {
            out &lt;&lt; <span class="string"><span class="delimiter">'</span><span class="content">°F</span><span class="delimiter">'</span></span>
        } <span class="keyword">else</span> <span class="keyword">if</span> ( attrs.unit == Unit.Metric ) {
            out &lt;&lt; <span class="string"><span class="delimiter">'</span><span class="content">°C</span><span class="delimiter">'</span></span>
        }

    }
}</code></pre>
</div>
</div>


<h2 id="view">3.9 View</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-mock-http-server/edit/grails3/src/main/docs/guide/view.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Create the next GSPs to render the gathered Weather information as an HTML page.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/views/home/index.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Current Weather&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">title&gt;</span></span><span class="error">
</span>    &lt;meta name=<span class="string"><span class="delimiter">&quot;</span><span class="content">layout</span><span class="delimiter">&quot;</span></span> content=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span> /&gt;
&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">head&gt;</span></span><span class="error">
</span>&lt;body&gt;
    &lt;div id=<span class="string"><span class="delimiter">&quot;</span><span class="content">content</span><span class="delimiter">&quot;</span></span> role=<span class="string"><span class="delimiter">&quot;</span><span class="content">main</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;section <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">row colset-2-its</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;<span class="class">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>currentWeather<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
                &lt;<span class="key">g</span>:render template=<span class="string"><span class="delimiter">&quot;</span><span class="content">/openweather/currentWeather</span><span class="delimiter">&quot;</span></span>
                          model=<span class="string"><span class="delimiter">&quot;</span><span class="content">[currentWeather: currentWeather, unit: unit]</span><span class="delimiter">&quot;</span></span>/&gt;
            &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;</span></span><span class="error">
</span>        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">section&gt;</span></span><span class="error">
</span>    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">body&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">html&gt;</span></span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/views/openweather/_currentWeather.gsp</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">&lt;<span class="key">g</span>:<span class="keyword">if</span> test=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>currentWeather.weatherList<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>&gt;
    &lt;<span class="key">g</span>:each <span class="keyword">in</span>=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>currentWeather.weatherList<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span> var=<span class="string"><span class="delimiter">&quot;</span><span class="content">weather</span><span class="delimiter">&quot;</span></span>&gt;
        &lt;div <span class="type">class</span>=<span class="string"><span class="delimiter">&quot;</span><span class="content">weatherBlock</span><span class="delimiter">&quot;</span></span>&gt;
            &lt;<span class="class">h2</span>&gt;&lt;b&gt;<span class="error">$</span>{currentWeather.cityName}&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">b&gt;&lt;</span><span class="delimiter">/</span></span>h2&gt;
            &lt;h3&gt;<span class="error">$</span>{currentWeather.main?.temperature} &lt;<span class="key">openweather</span>:temperatureSymbol unit=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>unit<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>/&gt;&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">h3&gt;</span></span><span class="error">
</span>            &lt;<span class="key">openweather</span>:image icon=<span class="string"><span class="delimiter">&quot;</span><span class="inline"><span class="inline-delimiter">${</span>weather.icon<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>/&gt;
            &lt;h4&gt;<span class="error">$</span>{weather.description}&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">h4&gt;</span></span><span class="error">
</span>        &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">div&gt;</span></span><span class="error">
</span>    &lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:each&gt;</span></span><span class="error">
</span>&lt;<span class="regexp"><span class="delimiter">/</span><span class="content">g:if&gt;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Add the next CSS snippet to style the weather forecast.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/assets/stylesheets/main.css</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="css"><span class="class">.weatherBlock</span> {
     <span class="key">width</span>: <span class="float">150px</span>;
     <span class="key">height</span>: <span class="float">200px</span>;
     <span class="key">margin</span>: <span class="float">10px</span> <span class="value">auto</span>;
     <span class="key">text-align</span>: <span class="value">center</span>;
     <span class="key">border</span>: <span class="float">1px</span> <span class="value">solid</span> <span class="color">#c0d3db</span>;
     <span class="key">float</span>: <span class="value">left</span>;
}</code></pre>
</div>
</div>


                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/gettingStarted.html">&lt;&lt; <strong>2</strong><span>Getting Started</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/runningTheApp.html"><strong>4</strong><span>Running the Application</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title" style="text-align: right"><a href="https://travis-ci.org/grails-guides/grails-mock-http-server"><img src="https://travis-ci.org/grails-guides/grails-mock-http-server.svg?branch=master" /></a></div>            
                 <div class="local-title">
                    <a href="https://github.com/grails-guides/grails-mock-http-server">
                    <svg height="35" class="octicon octicon-mark-github" viewBox="0 0 16 16" version="1.1" width="35" aria-hidden="true"><path fill-rule="evenodd" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0 0 16 8c0-4.42-3.58-8-8-8z"/></svg></a> &nbsp;&nbsp;Get the Code
                </div>
                <div class="menu">
                    <div class="input-group">                        
                        <button href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/grails-mock-http-server.git'" class="codeButton">SSH</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-mock-http-server.git'" class="codeButton">HTTPS</button>
                        <button onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-mock-http-server'" class="codeButton">Subversion</button>
                    </div>
       
                    <div class="input-group">                    
                        <!-- Target -->
                        <input id="github-url" value="git@github.com:grails-guides/grails-mock-http-server.git" type="text" />

                        <!-- Trigger -->
                        <button class="clipbtn" type="button" data-clipboard-target="#github-url">

                            <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
                        </button>       

                    </div>
                    <div class="input-group">
                      <a href="https://github.com/grails-guides/grails-mock-http-server/archive/master.zip" class="downloadButton">Download ZIP</a>
                    </div>
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    Copies of this document may be made for your own use and for distribution to others, provided that you do not charge any fee for such copies and further provided that each copy contains this Copyright Notice, whether distributed in print or electronically. All guides are released with an ASLv2 license for the code, and Creative Commons license for the writing. 
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
