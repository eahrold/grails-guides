<!DOCTYPE html>
<html>
  <head>
    <meta name='google-site-verification' content='REYQ1_I6HGowAE7LOLVqfQbnKaB4IfFpMlGzMbJj55Q' />
    <meta name='viewport' content='width=device-width, initial-scale=1' />
    <link rel='icon' href='../img/favicon.ico' />
    <link rel='mask-icon' href='/../img/grails-pinned-icon.svg' color='feb672' />
    <meta charset='UTF-8' />
    <title>Testing a Secured Grails Application | Grails Guides | Grails Framework</title>
    <meta name='description' content='Testing a Secured Grails Application. In this guide you will see how to test the security constraints you added with Grails Spring Security REST Plugin and Grails Spring Security Core Plugin.' />
    <link rel='stylesheet' href='../css/main.css' />
    <link rel='stylesheet' href='../css/screen.css' />
    <script src='https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js'></script>
  </head>
  <body class='guide'><header class='mainheader'>
  <div class='content'>
    <a href='http://grails.org/index.html'><img class='grailslogo' src='../img/grails_logo.svg' alt='Grails Logo' /></a>
    <a href='javascript:show(&apos;topmenus&apos;, &apos;showNavigationLink&apos;)' id='showNavigationLink' class='mobile align-center'>Show Navigation</a>
    <div id='topmenus'>
      <nav class='secondarymenu' id='secondarymenu'><ul>
  <li>
    <a href='http://grails.org/learning.html'>Learning</a>
  </li>
  <li>
    <a href='http://grails.org/community.html'>Community</a>
  </li>
  <li>
    <a href='http://grails.org/search.html'>Search</a>
  </li>
</ul></nav>
      <nav class='mainmenu' id='mainmenu'><ul>
  <li>
    <a href='http://grails.org/documentation.html'>Documentation</a>
  </li>
  <li>
    <a href='http://grails.org/download.html'>Download</a>
  </li>
  <li>
    <a href='http://plugins.grails.org'>Plugins</a>
  </li>
  <li>
    <a href='http://guides.grails.org/index.html'>Guides</a>
  </li>
  <li>
    <a href='http://grails.org/faq.html'>FAQ</a>
  </li>
  <li>
    <a href='http://grails.org/support.html'>Support</a>
  </li>
</ul></nav>
    </div>
  </div>
</header><div class='fullwidth'><article class="guide">
    <aside>
        <a href="https://travis-ci.org/grails-guides/grails-test-security"><img src="https://travis-ci.org/grails-guides/grails-test-security.svg?branch=master"></a>

        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/grails-guides/grails-test-security&quot;"><img height="15" src="../img/github_white.svg" alt="Github"/><span>&nbsp;Get the Code</span></button>


        <ul class="githublinks">
            <li><button type="button" class="btn btn-default" href="#" onclick="document.getElementById('github-url').value='git@github.com:grails-guides/grails-test-security.git'" class="codeButton">SSH</button></li>
            <li><button type="button" class="btn btn-default" onclick="document.getElementById('github-url').value='https://github.com/grails-guides/grails-test-security.git'" class="codeButton">HTTPS</button></li>
        </ul>
        <div class="input-group">
            <!-- Target -->
            <input id="github-url" value="git@github.com:grails-guides/grails-test-security.git" type="text" />
            <!-- Trigger -->
            <button type="button" class="clippy btn btn-default" type="button" data-clipboard-target="#github-url">
                <img width="13" src="../img/clippy.svg" alt="Copy to clipboard">
            </button>
        </div>
        <script>var clipboard = new Clipboard('.clippy');</script>
        <button type="button" class="btn btn-large" onclick="window.location.href=&quot;https://github.com/grails-guides/grails-test-security/archive/master.zip&quot;">Download ZIP</button>
        
        <div id="table-of-content">
            <h3>Table of Contents</h3>
            
            <div class="toc-item" style="margin-left:0px"><a href="#training"><strong>1</strong><span>Grails Training</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#gettingStarted"><strong>2</strong><span>Getting Started</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#requirements"><strong>2.1</strong><span>What you will need</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#howto"><strong>2.2</strong><span>How to complete the guide</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#writingTheApp"><strong>3</strong><span>Writing the Application</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#domainClass"><strong>3.1</strong><span>Domain Class</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#controller"><strong>3.2</strong><span>Web Controller</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#apiController"><strong>3.3</strong><span>Api Controller</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#securingTheApp"><strong>3.4</strong><span>Securing the App</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#testRestApi"><strong>3.5</strong><span>Test Rest Api</span></a></div>
            
            <div class="toc-item" style="margin-left:10px"><a href="#testing"><strong>3.6</strong><span>Test Web Endpoint</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#runningTheApp"><strong>4</strong><span>Running the Application</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#appendixA"><strong>5</strong><span>Appendix A</span></a></div>
            
            <div class="toc-item" style="margin-left:0px"><a href="#helpWithGrails"><strong>6</strong><span>Do you need help with Grails?</span></a></div>
            
            <div style="clear:both" ></div>
        </div>
        
    </aside>
    <header>
        <h1>Testing a Secured Grails Application</h1>
        <p>In this guide you will see how to test the security constraints you added with Grails Spring Security REST Plugin and Grails Spring Security Core Plugin.</p>
        <p><strong>Authors:</strong> Sergio del Amo</p>
        <p><strong>Grails Version:</strong> 3.3.8</p>
    </header>
    

<h1 id="training">1 Grails Training</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-test-security/edit/master/src/main/docs/guide/training.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p><strong>Grails Training</strong> - Developed and delivered by the folks who created and actively maintain the Grails framework!.</p>
</div>
<div id="ocitraining"></div>
<script type="text/javascript">
var getJSON = function(url, callback) {
    var xhr = new XMLHttpRequest();
    xhr.open('GET', url, true);
    xhr.responseType = 'json';
    xhr.onload = function() {
      var status = xhr.status;
      if (status == 200) {
        callback(null, xhr.response);
      } else {
        callback(status);
      }
    };
    xhr.send();
};
getJSON('https://oci-training.cfapps.io/training', function(err, data) {
  var msg = '';
  if (err != null) {
      msg = 'Something went wrong while retrieving OCI training offerings';

  } else {
      if ( data.length == 0 ) {
         msg = '<p><b>Nothing scheduled at the moment - please check back again soon!</b></p>.';

      } else {
        msg += '<table>';
        msg += '<thead>';
        msg += '<tr><th>Course</th><th>Date(s)</th><th>Instructor(s)</th><th>Hour(s)</th></tr>';
        msg += '</thead>';
        msg += '<tbody>';
        for ( var i = 0; i < data.length; i++ ) {
            msg += '<tr><td><a href="'+ data[i].enrollmentLink + '">'+ data[i].course + '</a></td><td>'+ data[i].dates + '</td><td>'+ data[i].instructors + '</td><td>'+ data[i].hours + '</td></tr>';
        }
        msg += '</tbody>';
        msg += '</table>';
      }
  }
  var ociTraining = document.getElementById("ocitraining");
  ociTraining.innerHTML = msg;
});
</script>


<h1 id="gettingStarted">2 Getting Started</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-test-security/edit/master/src/main/docs/guide/gettingStarted.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>In this guide you are going to:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Create a functional test of a REST API endpoint secured with the Grails Spring Security Rest Plugin</p>
</li>
<li>
<p>Create a <code>GebSpec</code> Functional test of a page secured with the Grails Spring Security Core Plugin. When you try
to access such a page you are redirected to a sign-in form.</p>
</li>
</ul>
</div>


<h2 id="requirements">2.1 What you will need</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-test-security/edit/master/src/main/docs/guide/requirements.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To complete this guide, you will need the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Some time on your hands</p>
</li>
<li>
<p>A decent text editor or IDE</p>
</li>
<li>
<p>JDK 1.7 or greater installed with <code>JAVA_HOME</code> configured appropriately</p>
</li>
</ul>
</div>


<h2 id="howto">2.2 How to complete the guide</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-test-security/edit/master/src/main/docs/guide/howto.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To get started do the following:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://github.com/grails-guides/grails-test-security/archive/master.zip">Download</a> and unzip the source</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>or</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clone the <a href="https://git-scm.com/">Git</a> repository:<br>
<code>git clone <a href="https://github.com/grails-guides/grails-test-security.git" class="bare">https://github.com/grails-guides/grails-test-security.git</a></code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The Grails guides repositories contain two folders:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>initial</code>  Initial project. Often a simple Grails app with some additional code to give you a head-start.</p>
</li>
<li>
<p><code>complete</code> A completed example. It is the result of working through the steps presented by the guide and applying those changes to the <code>initial</code> folder.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>To complete the guide, go to the <code>initial</code> folder</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>cd</code> into <code>grails-guides/grails-test-security/initial</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>and follow the instructions in the next sections.</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can go right to the <strong>completed example</strong> if you <code>cd</code> into <code>grails-guides/grails-test-security/complete</code>
</td>
</tr>
</table>
</div>


<h1 id="writingTheApp">3 Writing the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-test-security/edit/master/src/main/docs/guide/writingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to write an app which combines both a traditional web application and an API.
API endpoints will be prefixed with  <em>/api/</em></p>
</div>


<h2 id="domainClass">3.1 Domain Class</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-test-security/edit/master/src/main/docs/guide/domainClass.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We&#8217;ll create a <a href="http://docs.grails.org/latest/ref/Domain%20Classes/Usage.html">Domain Class</a>, <code>Announcement</code>, which we are going to use as an example through this guide:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./grailsw create-domain-class Announcement
| Created grails-app/domain/example/grails/Announcement.groovy
| Created src/test/groovy/example/grails/AnnouncementSpec.groovy</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/example/grails/Announcement.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">Announcement</span> {

    <span class="predefined-type">String</span> message

    <span class="directive">static</span> constraints = {
    }
}</code></pre>
</div>
</div>


<h2 id="controller">3.2 Web Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-test-security/edit/master/src/main/docs/guide/controller.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>We are going to use static Scaffolding to generate a controller for the web app.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./grailsw generate-all Announcement
| Rendered template Controller.groovy to destination grails-app/controllers/example/grails/AnnouncementController.groovy
| Rendered template Spec.groovy to destination src/test/groovy/example/grails/AnnouncementControllerSpec.groovy
| Scaffolding completed for grails-app/domain/example/grails/Announcement.groovy
| Rendered template edit.gsp to destination grails-app/views/announcement/edit.gsp
| Rendered template create.gsp to destination grails-app/views/announcement/create.gsp
| Rendered template index.gsp to destination grails-app/views/announcement/index.gsp
| Rendered template show.gsp to destination grails-app/views/announcement/show.gsp
| Views generated for grails-app/domain/example/grails/Announcement.groovy</code></pre>
</div>
</div>


<h2 id="apiController">3.3 Api Controller</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-test-security/edit/master/src/main/docs/guide/apiController.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To create the <code>Announcement</code> API controller we&#8217;ll use the <a href="http://docs.grails.org/latest/ref/Command%20Line/create-controller.html">create-controller command</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./grailsw create-controller ApiAnnouncement
Created grails-app/controllers/example/grails/ApiAnnouncementController.groovy
| Created src/test/groovy/example/grails/ApiAnnouncementControllerSpec.groovy</code></pre>
</div>
</div>
<div class="paragraph">
<p>We want this controller to handle any requests to <em>/api/announcements</em>. We&#8217;ll need to add the following line to our <code>UrlMappings</code>.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/example/grails/UrlMappings.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="string"><span class="delimiter">'</span><span class="content">/api/announcements</span><span class="delimiter">'</span></span>(<span class="key">controller</span>: <span class="string"><span class="delimiter">'</span><span class="content">apiAnnouncement</span><span class="delimiter">'</span></span>)</code></pre>
</div>
</div>
<div class="paragraph">
<p>The controller will be a <a href="http://docs.grails.org/latest/guide/webServices.html#extendingRestfulController">RestfulController</a>, and will only respond with JSON.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/controllers/example/grails/ApiAnnouncementController.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">grails.rest.RestfulController</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">ApiAnnouncementController</span> <span class="directive">extends</span> RestfulController {
    <span class="directive">static</span> responseFormats = [<span class="string"><span class="delimiter">'</span><span class="content">json</span><span class="delimiter">'</span></span>]

    ApiAnnouncementController() {
        <span class="local-variable">super</span>(Announcement)
    }
}</code></pre>
</div>
</div>


<h2 id="securingTheApp">3.4 Securing the App</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-test-security/edit/master/src/main/docs/guide/securingTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Add a dependency on the <a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/">Grails Spring Security Rest plugin</a>
and to the latest release of <a href="https://grails-plugins.github.io/grails-spring-security-core/v3/index.html">Spring Security Core</a>
to our <code>build.gradle</code> file.</p>
</div>
<div class="listingblock">
<div class="title">/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    compile <span class="string"><span class="delimiter">'</span><span class="content">org.grails.plugins:spring-security-rest:2.0.0.RC1</span><span class="delimiter">'</span></span>
    compile <span class="string"><span class="delimiter">'</span><span class="content">org.grails.plugins:spring-security-core:3.2.3</span><span class="delimiter">'</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll run the <em>s2-quickstart</em> command, provided by the  <a href="https://grails-plugins.github.io/grails-spring-security-core/v3/index.html">Spring Security Core Plugin</a>,
to generate <code>User</code> and <code>Authority</code> classes.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./grailsw s2-quickstart example.grails User SecurityRole</code></pre>
</div>
</div>
<div class="paragraph">
<p><code>s2-quickstart</code> script generates three domain classes; <code>User</code>, <code>SecurityRole</code> and <code>UserSecurityRole</code>.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/example/grails/User.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">groovy.transform.EqualsAndHashCode</span>
<span class="keyword">import</span> <span class="include">groovy.transform.ToString</span>
<span class="keyword">import</span> <span class="include">grails.compiler.GrailsCompileStatic</span>

<span class="annotation">@GrailsCompileStatic</span>
<span class="annotation">@EqualsAndHashCode</span>(includes=<span class="string"><span class="delimiter">'</span><span class="content">username</span><span class="delimiter">'</span></span>)
<span class="annotation">@ToString</span>(includes=<span class="string"><span class="delimiter">'</span><span class="content">username</span><span class="delimiter">'</span></span>, includeNames=<span class="predefined-constant">true</span>, includePackage=<span class="predefined-constant">false</span>)
<span class="type">class</span> <span class="class">User</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {
        <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1</span>

        <span class="predefined-type">String</span> username
        <span class="predefined-type">String</span> password
        <span class="type">boolean</span> enabled = <span class="predefined-constant">true</span>
        <span class="type">boolean</span> accountExpired
        <span class="type">boolean</span> accountLocked
        <span class="type">boolean</span> passwordExpired

        <span class="predefined-type">Set</span>&lt;SecurityRole&gt; getAuthorities() {
                (UserSecurityRole.findAllByUser(<span class="local-variable">this</span>) <span class="keyword">as</span> <span class="predefined-type">List</span>&lt;UserSecurityRole&gt;)*.securityRole <span class="keyword">as</span> <span class="predefined-type">Set</span>&lt;SecurityRole&gt;
        }

        <span class="directive">static</span> constraints = {
                password <span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">password</span>: <span class="predefined-constant">true</span>
                username <span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">unique</span>: <span class="predefined-constant">true</span>
        }

        <span class="directive">static</span> mapping = {
                password <span class="key">column</span>: <span class="string"><span class="delimiter">'</span><span class="content">`password`</span><span class="delimiter">'</span></span>
        }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/example/grails/SecurityRole.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">groovy.transform.EqualsAndHashCode</span>
<span class="keyword">import</span> <span class="include">groovy.transform.ToString</span>
<span class="keyword">import</span> <span class="include">grails.compiler.GrailsCompileStatic</span>

<span class="annotation">@GrailsCompileStatic</span>
<span class="annotation">@EqualsAndHashCode</span>(includes=<span class="string"><span class="delimiter">'</span><span class="content">authority</span><span class="delimiter">'</span></span>)
<span class="annotation">@ToString</span>(includes=<span class="string"><span class="delimiter">'</span><span class="content">authority</span><span class="delimiter">'</span></span>, includeNames=<span class="predefined-constant">true</span>, includePackage=<span class="predefined-constant">false</span>)
<span class="type">class</span> <span class="class">SecurityRole</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

        <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1</span>
        <span class="predefined-type">String</span> authority

        <span class="directive">static</span> constraints = {
                authority <span class="key">blank</span>: <span class="predefined-constant">false</span>, <span class="key">unique</span>: <span class="predefined-constant">true</span>
        }

        <span class="directive">static</span> mapping = {
                cache <span class="predefined-constant">true</span>
        }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/domain/example/grails/UserSecurityRole.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">grails.gorm.DetachedCriteria</span>
<span class="keyword">import</span> <span class="include">groovy.transform.ToString</span>

<span class="keyword">import</span> <span class="include">org.codehaus.groovy.util.HashCodeHelper</span>
<span class="keyword">import</span> <span class="include">grails.compiler.GrailsCompileStatic</span>

<span class="annotation">@SuppressWarnings</span>([<span class="string"><span class="delimiter">'</span><span class="content">FactoryMethodName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Instanceof</span><span class="delimiter">'</span></span>])
<span class="annotation">@GrailsCompileStatic</span>
<span class="annotation">@ToString</span>(cache=<span class="predefined-constant">true</span>, includeNames=<span class="predefined-constant">true</span>, includePackage=<span class="predefined-constant">false</span>)
<span class="type">class</span> <span class="class">UserSecurityRole</span> <span class="directive">implements</span> <span class="predefined-type">Serializable</span> {

        <span class="directive">private</span> <span class="directive">static</span> <span class="directive">final</span> <span class="type">long</span> serialVersionUID = <span class="integer">1</span>

        User user
        SecurityRole securityRole

        <span class="annotation">@Override</span>
        <span class="type">boolean</span> equals(other) {
                <span class="keyword">if</span> (other <span class="keyword">instanceof</span> UserSecurityRole) {
                        other.userId == user?.id &amp;&amp; other.securityRoleId == securityRole?.id
                }
        }

        <span class="annotation">@Override</span>
        <span class="type">int</span> hashCode() {
                <span class="type">int</span> hashCode = HashCodeHelper.initHash()
                <span class="keyword">if</span> (user) {
                        hashCode = HashCodeHelper.updateHash(hashCode, user.id)
                }
                <span class="keyword">if</span> (securityRole) {
                        hashCode = HashCodeHelper.updateHash(hashCode, securityRole.id)
                }
                hashCode
        }

        <span class="directive">static</span> UserSecurityRole get(<span class="type">long</span> userId, <span class="type">long</span> securityRoleId) {
                criteriaFor(userId, securityRoleId).get()
        }

        <span class="directive">static</span> <span class="type">boolean</span> exists(<span class="type">long</span> userId, <span class="type">long</span> securityRoleId) {
                criteriaFor(userId, securityRoleId).count()
        }

        <span class="directive">private</span> <span class="directive">static</span> DetachedCriteria criteriaFor(<span class="type">long</span> userId, <span class="type">long</span> securityRoleId) {
                UserSecurityRole.where {
                        user == User.load(userId) &amp;&amp;
                                        securityRole == SecurityRole.load(securityRoleId)
                }
        }

        <span class="directive">static</span> UserSecurityRole create(User user, SecurityRole securityRole, <span class="type">boolean</span> flush = <span class="predefined-constant">false</span>) {
                <span class="keyword">def</span> instance = <span class="keyword">new</span> UserSecurityRole(<span class="key">user</span>: user, <span class="key">securityRole</span>: securityRole)
                instance.save(<span class="key">flush</span>: flush)
                instance
        }

        <span class="directive">static</span> <span class="type">boolean</span> remove(User u, SecurityRole r) {
                <span class="keyword">if</span> (u != <span class="predefined-constant">null</span> &amp;&amp; r != <span class="predefined-constant">null</span>) {
                        UserSecurityRole.where { user == u &amp;&amp; securityRole == r }.deleteAll()
                }
        }

        <span class="directive">static</span> <span class="type">int</span> removeAll(User u) {
                u == <span class="predefined-constant">null</span> ? <span class="integer">0</span> : UserSecurityRole.where { user == u }.deleteAll() <span class="keyword">as</span> <span class="type">int</span>
        }

        <span class="directive">static</span> <span class="type">int</span> removeAll(SecurityRole r) {
                r == <span class="predefined-constant">null</span> ? <span class="integer">0</span> : UserSecurityRole.where { securityRole == r }.deleteAll() <span class="keyword">as</span> <span class="type">int</span>
        }

        <span class="directive">static</span> constraints = {
                securityRole <span class="key">validator</span>: { SecurityRole r, UserSecurityRole ur -&gt;
                        <span class="keyword">if</span> (ur.user?.id) {
                                UserSecurityRole.withNewSession {
                                        <span class="keyword">if</span> (UserSecurityRole.exists(ur.user.id, r.id)) {
                                                <span class="keyword">return</span> [<span class="string"><span class="delimiter">'</span><span class="content">userRole.exists</span><span class="delimiter">'</span></span>]
                                        }
                                }
                        }
                }
        }

        <span class="directive">static</span> mapping = {
                id <span class="key">composite</span>: [<span class="string"><span class="delimiter">'</span><span class="content">user</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">securityRole</span><span class="delimiter">'</span></span>]
                version <span class="predefined-constant">false</span>
        }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you are using GORM 6.0.10 or a later version and Spring Security core 3.1.2 or later version, s2-quickstart
generates and registers a bean to handle password encoding:</p>
</div>
<div class="listingblock">
<div class="title">src/main/groovy/example/grails/UserPasswordEncoderListener.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">grails.plugin.springsecurity.SpringSecurityService</span>
<span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.core.Datastore</span>
<span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.engine.event.AbstractPersistenceEvent</span>
<span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.engine.event.AbstractPersistenceEventListener</span>
<span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.engine.event.EventType</span>
<span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.engine.event.PreInsertEvent</span>
<span class="keyword">import</span> <span class="include">org.grails.datastore.mapping.engine.event.PreUpdateEvent</span>
<span class="keyword">import</span> <span class="include">org.springframework.context.ApplicationEvent</span>
<span class="keyword">import</span> <span class="include">org.springframework.beans.factory.annotation.Autowired</span>
<span class="keyword">import</span> <span class="include">groovy.transform.CompileStatic</span>

<span class="annotation">@SuppressWarnings</span>([<span class="string"><span class="delimiter">'</span><span class="content">UnnecessaryGetter</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">LineLength</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Instanceof</span><span class="delimiter">'</span></span>])
<span class="annotation">@CompileStatic</span>
<span class="type">class</span> <span class="class">UserPasswordEncoderListener</span> <span class="directive">extends</span> AbstractPersistenceEventListener {

    <span class="annotation">@Autowired</span>
    SpringSecurityService springSecurityService

    UserPasswordEncoderListener(<span class="directive">final</span> Datastore datastore) {
        <span class="local-variable">super</span>(datastore)
    }

    <span class="annotation">@Override</span>
    <span class="directive">protected</span> <span class="type">void</span> onPersistenceEvent(AbstractPersistenceEvent event) {
        <span class="keyword">if</span> (event.entityObject <span class="keyword">instanceof</span> User) {
            User u = (event.entityObject <span class="keyword">as</span> User)
            <span class="keyword">if</span> (u.password &amp;&amp; (event.eventType == EventType.PreInsert || (event.eventType == EventType.PreUpdate &amp;&amp; u.isDirty(<span class="string"><span class="delimiter">'</span><span class="content">password</span><span class="delimiter">'</span></span>)))) {
                event.getEntityAccess().setProperty(<span class="string"><span class="delimiter">'</span><span class="content">password</span><span class="delimiter">'</span></span>, encodePassword(u.password))
            }
        }
    }

    <span class="annotation">@Override</span>
    <span class="type">boolean</span> supportsEventType(<span class="predefined-type">Class</span>&lt;? <span class="directive">extends</span> ApplicationEvent&gt; eventType) {
        eventType == PreUpdateEvent || eventType == PreInsertEvent
    }

    <span class="directive">private</span> <span class="predefined-type">String</span> encodePassword(<span class="predefined-type">String</span> password) {
        springSecurityService?.passwordEncoder ? springSecurityService.encodePassword(password) : password
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/spring/resources.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">import</span> <span class="include">example.grails.UserPasswordEncoderListener</span>
<span class="comment">// Place your Spring DSL code here</span>
beans = {
    userPasswordEncoderListener(UserPasswordEncoderListener, ref(<span class="string"><span class="delimiter">'</span><span class="content">hibernateDatastore</span><span class="delimiter">'</span></span>))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>We&#8217;ll configure the security rules of the application in the file <em>application.groovy</em>, as show below. We have one <a href="http://alvarosanchez.github.io/grails-spring-security-rest/latest/docs/#_plugin_configuration">stateless chain and one Traditional Chain</a>.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grails {
    plugin {
        springsecurity {
            rest {
                token {
                    storage {
                        jwt {
                            secret = <span class="string"><span class="delimiter">'</span><span class="content">pleaseChangeThisSecretForANewOne</span><span class="delimiter">'</span></span>
                        }
                    }
                }
            }
            securityConfigType = <span class="string"><span class="delimiter">&quot;</span><span class="content">InterceptUrlMap</span><span class="delimiter">&quot;</span></span>  <i class="conum" data-value="1"></i><b>(1)</b>
            filterChain {
                chainMap = [
                [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/api/**</span><span class="delimiter">'</span></span>,<span class="key">filters</span>: <span class="string"><span class="delimiter">'</span><span class="content">JOINED_FILTERS,-anonymousAuthenticationFilter,-exceptionTranslationFilter,-authenticationProcessingFilter,-securityContextPersistenceFilter,-rememberMeAuthenticationFilter</span><span class="delimiter">'</span></span>],<i class="conum" data-value="2"></i><b>(2)</b>
                [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/**</span><span class="delimiter">'</span></span>, <span class="key">filters</span>: <span class="string"><span class="delimiter">'</span><span class="content">JOINED_FILTERS,-restTokenValidationFilter,-restExceptionTranslationFilter</span><span class="delimiter">'</span></span>] <i class="conum" data-value="3"></i><b>(3)</b>
                ]
            }
            userLookup {
                userDomainClassName = <span class="string"><span class="delimiter">'</span><span class="content">example.grails.User</span><span class="delimiter">'</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
                authorityJoinClassName = <span class="string"><span class="delimiter">'</span><span class="content">example.grails.UserSecurityRole</span><span class="delimiter">'</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
            }
            authority {
                className = <span class="string"><span class="delimiter">'</span><span class="content">example.grails.SecurityRole</span><span class="delimiter">'</span></span> <i class="conum" data-value="4"></i><b>(4)</b>
            }
            interceptUrlMap = [
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/</span><span class="delimiter">'</span></span>,                      <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/error</span><span class="delimiter">'</span></span>,                 <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/index</span><span class="delimiter">'</span></span>,                 <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/index.gsp</span><span class="delimiter">'</span></span>,             <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/shutdown</span><span class="delimiter">'</span></span>,              <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/assets/**</span><span class="delimiter">'</span></span>,             <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/**/js/**</span><span class="delimiter">'</span></span>,              <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/**/css/**</span><span class="delimiter">'</span></span>,             <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/**/images/**</span><span class="delimiter">'</span></span>,          <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/**/favicon.ico</span><span class="delimiter">'</span></span>,        <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/login/**</span><span class="delimiter">'</span></span>,              <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]], <i class="conum" data-value="5"></i><b>(5)</b>
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/logout</span><span class="delimiter">'</span></span>,                <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/logout/**</span><span class="delimiter">'</span></span>,             <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">permitAll</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/announcement</span><span class="delimiter">'</span></span>,          <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">ROLE_EMPLOYEE</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/announcement/index</span><span class="delimiter">'</span></span>,    <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">ROLE_EMPLOYEE</span><span class="delimiter">'</span></span>]],  <i class="conum" data-value="6"></i><b>(6)</b>
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/announcement/create</span><span class="delimiter">'</span></span>,   <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/announcement/save</span><span class="delimiter">'</span></span>,     <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/announcement/update</span><span class="delimiter">'</span></span>,   <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/announcement/delete/*</span><span class="delimiter">'</span></span>, <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/announcement/edit/*</span><span class="delimiter">'</span></span>,   <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/announcement/show/*</span><span class="delimiter">'</span></span>,   <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">ROLE_EMPLOYEE</span><span class="delimiter">'</span></span>]],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/api/login</span><span class="delimiter">'</span></span>,             <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_ANONYMOUS</span><span class="delimiter">'</span></span>]], <i class="conum" data-value="7"></i><b>(7)</b>
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/oauth/access_token</span><span class="delimiter">'</span></span>,    <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_ANONYMOUS</span><span class="delimiter">'</span></span>]], <i class="conum" data-value="8"></i><b>(8)</b>
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/api/announcements</span><span class="delimiter">'</span></span>,     <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span>], <span class="key">httpMethod</span>: <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>],  <i class="conum" data-value="9"></i><b>(9)</b>
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/api/announcements/*</span><span class="delimiter">'</span></span>,   <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span>], <span class="key">httpMethod</span>: <span class="string"><span class="delimiter">'</span><span class="content">GET</span><span class="delimiter">'</span></span>],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/api/announcements/*</span><span class="delimiter">'</span></span>,   <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span>], <span class="key">httpMethod</span>: <span class="string"><span class="delimiter">'</span><span class="content">DELETE</span><span class="delimiter">'</span></span>],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/api/announcements</span><span class="delimiter">'</span></span>,     <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span>], <span class="key">httpMethod</span>: <span class="string"><span class="delimiter">'</span><span class="content">POST</span><span class="delimiter">'</span></span>],
                    [<span class="key">pattern</span>: <span class="string"><span class="delimiter">'</span><span class="content">/api/announcements/*</span><span class="delimiter">'</span></span>,   <span class="key">access</span>: [<span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span>], <span class="key">httpMethod</span>: <span class="string"><span class="delimiter">'</span><span class="content">PUT</span><span class="delimiter">'</span></span>]
            ]
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>We choose to configure security with a <a href="https://grails-plugins.github.io/grails-spring-security-core/v3/index.html#configGroovyMap">InterceptUrlMap</a></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>Stateless Chain</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>Traditional chain</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Classes generated by the s2-quickstart script</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td><a href="https://grails-plugins.github.io/grails-spring-security-core/v3/index.html#urlProperties">URL of login page</a></td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>Url accesible only for users authenticated and with role ROLE_BOSS or ROLE_EMPLOYEE</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>Spring Security Rest for Grails default Authentication Endpoint. It should allow anonymous access</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>Spring Security Rest for Grails default Refresh Token Endpoint. It should allow anonymous access</td>
</tr>
<tr>
<td><i class="conum" data-value="9"></i><b>9</b></td>
<td>Url accesible only for users authenticated and with role ROLE_BOSS</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>We&#8217;ll populate our database in <code>BootStrap</code>, inserting two users when the application starts.</p>
</div>
<div class="listingblock">
<div class="title">grails-app/init/example/grails/BootStrap.groovy</div>
<div class="content">
<pre>package example.grails

import grails.compiler.GrailsCompileStatic

@GrailsCompileStatic
class BootStrap {

    AnnouncementService announcementService

    def init = { servletContext -&gt;

        def authorities = ['ROLE_BOSS', 'ROLE_EMPLOYEE']
        authorities.each { String authority -&gt;
            if ( !SecurityRole.findByAuthority(authority) ) {
                new SecurityRole(authority: authority).save()
            }
        }

        if ( !User.findByUsername('sherlock') ) {
            def u = new User(username: 'sherlock', password: 'elementary')
            u.save()
            new UserSecurityRole(user: u, securityRole: SecurityRole.findByAuthority('ROLE_BOSS')).save()
        }

        if ( !User.findByUsername('watson') ) {
            def u = new User(username: 'watson', password: '221Bbakerstreet')
            u.save()
            new UserSecurityRole(user: u, securityRole: SecurityRole.findByAuthority('ROLE_EMPLOYEE')).save()
        }

        announcementService.save('The Hound of the Baskervilles')
    }
    def destroy = {
    }
}</pre>
</div>
</div>


<h2 id="testRestApi">3.5 Test Rest Api</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-test-security/edit/master/src/main/docs/guide/testRestApi.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>To test REST part of the application, we use <a href="https://docs.micronaut.io/snapshot/guide/index.html#httpClient">Micronaut&#8217;s HttpClient</a>. We need to add the dependency:</p>
</div>
<div class="listingblock">
<div class="title">/gradle.properties</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">grailsVersion=<span class="float">3.3</span><span class="float">.8</span>
gormVersion=<span class="float">6.1</span><span class="float">.10</span>.RELEASE
gradleWrapperVersion=<span class="float">3.5</span>
assetPipelineVersion=<span class="float">2.14</span><span class="float">.8</span>
micronautVersion=<span class="float">1.0</span><span class="float">.0</span>.RC1
gebVersion=<span class="float">2.2</span>
seleniumVersion=<span class="float">3.12</span><span class="float">.0</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/build.gradle</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy">    testCompile <span class="string"><span class="delimiter">&quot;</span><span class="content">io.micronaut:http-client:</span><span class="inline"><span class="inline-delimiter">$</span>micronautVersion</span><span class="delimiter">&quot;</span></span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Our first test will verify that the <em>/api/announcements</em> endpoint is only accessible to users with role <em>ROLE_BOSS</em></p>
</div>
<div class="listingblock">
<div class="title">/src/integration-test/groovy/example/grails/ApiAnnouncementControllerSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">grails.testing.mixin.integration.Integration</span>
<span class="keyword">import</span> <span class="include">io.micronaut.core.type.Argument</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpRequest</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpResponse</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.HttpStatus</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.HttpClient</span>
<span class="keyword">import</span> <span class="include">io.micronaut.http.client.exceptions.HttpClientException</span>
<span class="keyword">import</span> <span class="include">spock.lang.AutoCleanup</span>
<span class="keyword">import</span> <span class="include">spock.lang.Shared</span>
<span class="keyword">import</span> <span class="include">spock.lang.Specification</span>
<span class="keyword">import</span> <span class="include">grails.testing.spock.OnceBefore</span>

<span class="annotation">@SuppressWarnings</span>([<span class="string"><span class="delimiter">'</span><span class="content">MethodName</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">DuplicateNumberLiteral</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">Instanceof</span><span class="delimiter">'</span></span>])
<span class="annotation">@Integration</span>
<span class="type">class</span> <span class="class">ApiAnnouncementControllerSpec</span> <span class="directive">extends</span> Specification {

    <span class="annotation">@Shared</span>
    <span class="annotation">@AutoCleanup</span>
    HttpClient client

    <span class="annotation">@OnceBefore</span> <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="type">void</span> init() {
        client  = HttpClient.create(<span class="keyword">new</span> <span class="predefined-type">URL</span>(<span class="string"><span class="delimiter">&quot;</span><span class="content">http://localhost:</span><span class="inline"><span class="inline-delimiter">$</span>serverPort</span><span class="delimiter">&quot;</span></span>)) <i class="conum" data-value="2"></i><b>(2)</b>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">'</span><span class="content">test /api/announcements url is secured</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>:
        HttpRequest request = HttpRequest.GET(<span class="string"><span class="delimiter">'</span><span class="content">/api/announcements</span><span class="delimiter">'</span></span>)
        client.toBlocking().exchange(request,  <i class="conum" data-value="3"></i><b>(3)</b>
                Argument.of(<span class="predefined-type">List</span>, AnnouncementView),
                Argument.of(CustomError))

        <span class="key">then</span>:
        HttpClientException e = thrown(HttpClientException)
        e.response.status == HttpStatus.UNAUTHORIZED <i class="conum" data-value="4"></i><b>(4)</b>

        <span class="key">when</span>:
        Optional&lt;CustomError&gt; jsonError = e.response.getBody(CustomError)

        <span class="key">then</span>:
        jsonError.isPresent()
        jsonError.get().status == <span class="integer">401</span>
        jsonError.get().error == <span class="string"><span class="delimiter">'</span><span class="content">Unauthorized</span><span class="delimiter">'</span></span>
        jsonError.get().message == <span class="string"><span class="delimiter">'</span><span class="content">No message available</span><span class="delimiter">'</span></span>
        jsonError.get().path == <span class="string"><span class="delimiter">'</span><span class="content">/api/announcements</span><span class="delimiter">'</span></span>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test a user with the role ROLE_BOSS is able to access /api/announcements url</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">login with the sherlock</span><span class="delimiter">'</span></span>
        UserCredentials credentials = <span class="keyword">new</span> UserCredentials(<span class="key">username</span>: <span class="string"><span class="delimiter">'</span><span class="content">sherlock</span><span class="delimiter">'</span></span>, <span class="key">password</span>: <span class="string"><span class="delimiter">'</span><span class="content">elementary</span><span class="delimiter">'</span></span>)
        HttpRequest request = HttpRequest.POST(<span class="string"><span class="delimiter">'</span><span class="content">/api/login</span><span class="delimiter">'</span></span>, credentials) <i class="conum" data-value="5"></i><b>(5)</b>
        HttpResponse&lt;BearerToken&gt; resp = client.toBlocking().exchange(request, BearerToken)

        <span class="key">then</span>:
        resp.status.code == <span class="integer">200</span>
        resp.body().roles.find { <span class="local-variable">it</span> == <span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span> }

        <span class="key">when</span>:
        <span class="predefined-type">String</span> accessToken = resp.body().accessToken

        <span class="key">then</span>:
        accessToken

        <span class="key">when</span>:
        HttpResponse&lt;<span class="predefined-type">List</span>&gt; rsp = client.toBlocking().exchange(HttpRequest.GET(<span class="string"><span class="delimiter">'</span><span class="content">/api/announcements</span><span class="delimiter">'</span></span>)
                .header(<span class="string"><span class="delimiter">'</span><span class="content">Authorization</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bearer </span><span class="inline"><span class="inline-delimiter">${</span>accessToken<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>), Argument.of(<span class="predefined-type">List</span>, AnnouncementView)) <i class="conum" data-value="6"></i><b>(6)</b>

        <span class="key">then</span>:
        rsp.status.code == <span class="integer">200</span> <i class="conum" data-value="7"></i><b>(7)</b>
        rsp.body() != <span class="predefined-constant">null</span>
        ((<span class="predefined-type">List</span>)rsp.body()).size() == <span class="integer">1</span>
        ((<span class="predefined-type">List</span>)rsp.body()).get(<span class="integer">0</span>) <span class="keyword">instanceof</span> AnnouncementView
        ((AnnouncementView) ((<span class="predefined-type">List</span>)rsp.body()).get(<span class="integer">0</span>)).message == <span class="string"><span class="delimiter">'</span><span class="content">The Hound of the Baskervilles</span><span class="delimiter">'</span></span>
    }

    <span class="keyword">def</span> <span class="string"><span class="delimiter">&quot;</span><span class="content">test a user with the role ROLE_EMPLOYEE is NOT able to access /api/announcements url</span><span class="delimiter">&quot;</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">login with the watson</span><span class="delimiter">'</span></span>

        UserCredentials creds = <span class="keyword">new</span> UserCredentials(<span class="key">username</span>: <span class="string"><span class="delimiter">'</span><span class="content">watson</span><span class="delimiter">'</span></span>, <span class="key">password</span>: <span class="string"><span class="delimiter">'</span><span class="content">221Bbakerstreet</span><span class="delimiter">'</span></span>)
        HttpRequest request = HttpRequest.POST(<span class="string"><span class="delimiter">'</span><span class="content">/api/login</span><span class="delimiter">'</span></span>, creds)
        HttpResponse&lt;BearerToken&gt; resp = client.toBlocking().exchange(request, BearerToken)

        <span class="key">then</span>:
        resp.status.code == <span class="integer">200</span>
        !resp.body().roles.find { <span class="local-variable">it</span> == <span class="string"><span class="delimiter">'</span><span class="content">ROLE_BOSS</span><span class="delimiter">'</span></span> }
        resp.body().roles.find { <span class="local-variable">it</span> == <span class="string"><span class="delimiter">'</span><span class="content">ROLE_EMPLOYEE</span><span class="delimiter">'</span></span> }

        <span class="key">when</span>:
        <span class="predefined-type">String</span> accessToken = resp.body().accessToken

        <span class="key">then</span>:
        accessToken

        <span class="key">when</span>:
        resp = client.toBlocking().exchange(HttpRequest.GET(<span class="string"><span class="delimiter">'</span><span class="content">/api/announcements</span><span class="delimiter">'</span></span>)
                .header(<span class="string"><span class="delimiter">'</span><span class="content">Authorization</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">&quot;</span><span class="content">Bearer </span><span class="inline"><span class="inline-delimiter">${</span>accessToken<span class="inline-delimiter">}</span></span><span class="delimiter">&quot;</span></span>))

        <span class="key">then</span>:
        <span class="keyword">def</span> e = thrown(HttpClientException)
        e.response.status == HttpStatus.FORBIDDEN <i class="conum" data-value="8"></i><b>(8)</b>
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The <code>grails.testing.spock.OnceBefore</code> annotation is a shorthand way of accomplishing the same behavior that would be accomplished by applying both the <code>@RunOnce</code> and <code>@Before</code> annotations to a fixture method.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><em>serverPort</em> property is automatically injected and it contains the random port where the app will be running for the functional test.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>With Micronaut HTTP client you can bind POJOs to the response body easily.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The server returns a 401, indicating that the resource is secured.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>Call the authentication endpoint</td>
</tr>
<tr>
<td><i class="conum" data-value="6"></i><b>6</b></td>
<td>We pass the <em>access_token</em> we obtained from the authentication endpoint in the request headers.</td>
</tr>
<tr>
<td><i class="conum" data-value="7"></i><b>7</b></td>
<td>An authenticated user with the role <code>ROLE_BOSS</code> can access the resource.</td>
</tr>
<tr>
<td><i class="conum" data-value="8"></i><b>8</b></td>
<td>An authenticated user but without the role <code>ROLE_BOSS</code> is not allowed to access the resource.</td>
</tr>
</table>
</div>


<h2 id="testing">3.6 Test Web Endpoint</h2>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-test-security/edit/master/src/main/docs/guide/testing.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>Now we are going to execute a Functional Test using the <a href="http://gebish.org">Geb framework</a>.</p>
</div>
<div class="paragraph">
<p>To make this test easier to read and maintain we&#8217;ve created two Geb Pages: a <em>LoginPage</em> and an
<em>AnnouncementListingPage</em>.</p>
</div>
<div class="listingblock">
<div class="title">/src/integration-test/groovy/example/grails/LoginPage.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">geb.Page</span>

<span class="type">class</span> <span class="class">LoginPage</span> <span class="directive">extends</span> Page {
    <span class="directive">static</span> url = <span class="string"><span class="delimiter">'</span><span class="content">/login/auth</span><span class="delimiter">'</span></span>

    <span class="directive">static</span> at = {
        title == <span class="string"><span class="delimiter">'</span><span class="content">Login</span><span class="delimiter">'</span></span>
    }

    <span class="directive">static</span> content = {
        loginButton { <span class="error">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#submit</span><span class="delimiter">'</span></span>, <span class="integer">0</span>) }
        usernameInputField { <span class="error">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#username</span><span class="delimiter">'</span></span>, <span class="integer">0</span>) }
        passwordInputField { <span class="error">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#password</span><span class="delimiter">'</span></span>, <span class="integer">0</span>) }
    }

    <span class="type">void</span> login(<span class="predefined-type">String</span> username, <span class="predefined-type">String</span> password) {
        usernameInputField &lt;&lt; username
        passwordInputField &lt;&lt; password
        loginButton.click()
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/src/integration-test/groovy/example/grails/AnnouncementListingPage.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">geb.Page</span>

<span class="type">class</span> <span class="class">AnnouncementListingPage</span> <span class="directive">extends</span> Page {
    <span class="directive">static</span> url = <span class="string"><span class="delimiter">'</span><span class="content">/announcement/index</span><span class="delimiter">'</span></span>

    <span class="directive">static</span> at = {
        <span class="error">$</span>(<span class="string"><span class="delimiter">'</span><span class="content">#list-announcement</span><span class="delimiter">'</span></span>).text()?.contains <span class="string"><span class="delimiter">'</span><span class="content">Announcement List</span><span class="delimiter">'</span></span>
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">/src/integration-test/groovy/example/grails/AnnouncementControllerSpec.groovy</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="keyword">package</span> example.grails

<span class="keyword">import</span> <span class="include">geb.spock.GebSpec</span>
<span class="keyword">import</span> <span class="include">grails.testing.mixin.integration.Integration</span>

<span class="annotation">@SuppressWarnings</span>(<span class="string"><span class="delimiter">'</span><span class="content">MethodName</span><span class="delimiter">'</span></span>)
<span class="annotation">@Integration</span>
<span class="type">class</span> <span class="class">AnnouncementControllerSpec</span> <span class="directive">extends</span> GebSpec {

    <span class="type">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test /announcement/index is secured, but accesible to users with role ROLE_BOSS</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">try to visit announcement listing without login</span><span class="delimiter">'</span></span>
        go <span class="string"><span class="delimiter">'</span><span class="content">/announcement/index</span><span class="delimiter">'</span></span>

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">it is redirected to login page</span><span class="delimiter">'</span></span>
        at LoginPage

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">signs in with a ROLE_BOSS user</span><span class="delimiter">'</span></span>
        LoginPage page = browser.page(LoginPage)
        page.login(<span class="string"><span class="delimiter">'</span><span class="content">sherlock</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">elementary</span><span class="delimiter">'</span></span>)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">he gets access to the announcement listing page</span><span class="delimiter">'</span></span>
        at AnnouncementListingPage
    }

    <span class="type">void</span> <span class="string"><span class="delimiter">'</span><span class="content">test /announcement/index is secured, but accesible to users with role ROLE_EMPLOYEE</span><span class="delimiter">'</span></span>() {
        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">try to visit announcement listing without login</span><span class="delimiter">'</span></span>
        go <span class="string"><span class="delimiter">'</span><span class="content">/announcement/index</span><span class="delimiter">'</span></span>

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">it is redirected to login page</span><span class="delimiter">'</span></span>
        at LoginPage

        <span class="key">when</span>: <span class="string"><span class="delimiter">'</span><span class="content">signs in with a ROLE_EMPLOYEE user</span><span class="delimiter">'</span></span>
        LoginPage page = browser.page(LoginPage)
        page.login(<span class="string"><span class="delimiter">'</span><span class="content">watson</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">221Bbakerstreet</span><span class="delimiter">'</span></span>)

        <span class="key">then</span>: <span class="string"><span class="delimiter">'</span><span class="content">he gets access to the announcement listing page</span><span class="delimiter">'</span></span>
        at AnnouncementListingPage
    }
}</code></pre>
</div>
</div>


<h1 id="runningTheApp">4 Running the Application</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-test-security/edit/master/src/main/docs/guide/runningTheApp.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
We have removed the unit tests in this project. Our project
contains only the integration and functional tests displayed in the previous code listings.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>To run the tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="CodeRay highlight"><code data-lang="bash">./grailsw
grails&gt; test-app
grails&gt; open test-report</code></pre>
</div>
</div>


<h1 id="appendixA">5 Appendix A</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-test-security/edit/master/src/main/docs/guide/appendixA.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<div class="paragraph">
<p>For versions of GORM older than 6.0.10 or Spring Security Core Plugin prior to 3.1.2, <code>s2-quickstart</code> handles password
encoding directly with the
injection of <code>SpringSecurityService</code> in the User class. Since Grails 3.2.8. service injection
is disabled in domain classes. However, you can turn service injection on in domain classes:</p>
</div>
<div class="listingblock">
<div class="title">grails-app/conf/application.yml</div>
<div class="content">
<pre class="CodeRay highlight"><code data-lang="groovy"><span class="key">grails</span>:
    <span class="key">gorm</span>:
        <span class="error">#</span> Whether to autowire entities.
        <span class="error">#</span> Disabled by <span class="keyword">default</span> <span class="keyword">for</span> performance reasons.
        autowire: <span class="predefined-constant">true</span></code></pre>
</div>
</div>


<h1 id="helpWithGrails">6 Do you need help with Grails?</h1>

<div class='contribute-btn'>
    <button type='button' class='btn btn-default' onclick='window.location.href="https://github.com/grails-guides/grails-test-security/edit/master/src/main/docs/guide/helpWithGrails.adoc"'>
        <i class='fa fa-pencil-square-o'></i> Improve this doc
    </button>
</div>


<h3 style="color: #333;">OCI sponsored the creation of this Guide. OCI offers several <a href="https://objectcomputing.com/products/grails/consulting-support/">Grails services</a>:</h3>

<img src="../img/oci-grails-services.svg"/>

<h3>Free consultation </h3>

<!-- This is the code that is needed to run the form -->

<!--Copy and paste into the document's head or body.-->

<script type="text/javascript">

    /** This section is only needed once per page if manually copying **/
    if (typeof MauticSDKLoaded == 'undefined') {
        var MauticSDKLoaded = true;
        var head            = document.getElementsByTagName('head')[0];
        var script          = document.createElement('script');
        script.type         = 'text/javascript';
        script.src          = 'https://mautic.objectcomputing.com/media/js/mautic-form.js';
        script.onload       = function() {
            MauticSDK.onLoad();
        };
        head.appendChild(script);
        var MauticDomain = 'https://mautic.objectcomputing.com';
        var MauticLang   = {
            'submittingMessage': "Please wait..."
        }
    }
</script>

<!--Copy and paste into the document's body.-->

<style type="text/css" scoped>
    .mauticform_wrapper { max-width: 600px; margin: 10px auto; }
    .mauticform-innerform {}
    .mauticform-post-success {}
    .mauticform-name { font-weight: bold; font-size: 1.5em; margin-bottom: 3px; }
    .mauticform-description { margin-top: 2px; margin-bottom: 10px; }
    .mauticform-error { margin-bottom: 10px; color: red; }
    .mauticform-message { margin-bottom: 10px;color: green; }
    .mauticform-row { display: block; margin-bottom: 20px; }
    .mauticform-label { font-size: 1.1em; display: block; font-weight: bold; margin-bottom: 5px; }
    .mauticform-row.mauticform-required .mauticform-label:after { color: #e32; content: " *"; display: inline; }
    .mauticform-helpmessage { display: block; font-size: 0.9em; margin-bottom: 3px; }
    .mauticform-errormsg { display: block; color: red; margin-top: 2px; }
    .mauticform-selectbox, .mauticform-input, .mauticform-textarea { width: 100%; padding: 0.5em 0.5em; border: 1px solid #CCC; background: #fff; box-shadow: 0px 0px 0px #fff inset; border-radius: 4px; box-sizing: border-box; }
    .mauticform-checkboxgrp-row {}
    .mauticform-checkboxgrp-label { font-weight: normal; }
    .mauticform-checkboxgrp-checkbox {}
    .mauticform-radiogrp-row {}
    .mauticform-radiogrp-label { font-weight: normal; }
    .mauticform-radiogrp-radio {}
    .mauticform-button-wrapper .mauticform-button.btn-default, .mauticform-pagebreak-wrapper .mauticform-pagebreak.btn-default { font-size: 14px; color: #fff;background-color: #feb672 ;border-color: #dddddd; padding: 15px 30px;}
    .mauticform-button-wrapper .mauticform-button, .mauticform-pagebreak-wrapper .mauticform-pagebreak { display: inline-block;margin-bottom: 0;font-weight: 600;text-align: center;vertical-align: middle;cursor: pointer;background-image: none;border: 1px solid transparent;white-space: nowrap;padding: 6px 12px;font-size: 13px;line-height: 1.3856;border-radius: none;-webkit-user-select: none;-moz-user-select: none;-ms-user-select: none;user-select: none;}
    .mauticform-button-wrapper .mauticform-button.btn-default[disabled], .mauticform-pagebreak-wrapper .mauticform-pagebreak.btn-default[disabled] { background-color:#feb672; border-color: #dddddd; opacity: 0.75; cursor: not-allowed; font-size: 14px; color: #fff; padding: 15px 30px;}
    .mauticform-pagebreak-wrapper .mauticform-button-wrapper {  display: inline; }
</style>
<div id="mauticform_wrapper_grailsorgconsultationform" class="mauticform_wrapper">
    <form autocomplete="false" role="form" method="post" action="https://mautic.objectcomputing.com/form/submit?formId=3" id="mauticform_grailsorgconsultationform" data-mautic-form="grailsorgconsultationform">

        <div class="mauticform-innerform">

          <div class="mauticform-page-wrapper mauticform-page-1" data-mautic-form-page="1">

            <div id="mauticform_grailsorgconsultationform_first_name"  data-validate="first_name" data-validation-type="text" class="mauticform-row mauticform-text mauticform-field-1 mauticform-required col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_first_name" name="mauticform[first_name]" value="" placeholder="First Name *" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_last_name"  data-validate="last_name" data-validation-type="text" class="mauticform-row mauticform-text mauticform-field-2 mauticform-required col-lg-6 col-md-6 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_last_name" name="mauticform[last_name]" value="" placeholder="Last Name *" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_email"  data-validate="email" data-validation-type="email" class="mauticform-row mauticform-email mauticform-field-3 mauticform-required col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_email" name="mauticform[email]" value="" placeholder="Email *" class="mauticform-input" type="email" />
                <span class="mauticform-errormsg" style="display: none;">This is required.</span>
            </div>

            <div id="mauticform_grailsorgconsultationform_phone"  class="mauticform-row mauticform-tel mauticform-field-4 col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_phone" name="mauticform[phone]" value="" placeholder="Phone" class="mauticform-input" type="tel" />
                <span class="mauticform-errormsg" style="display: none;"></span>
            </div>

            <div id="mauticform_grailsorgconsultationform_company"  class="mauticform-row mauticform-text mauticform-field-5 col-lg-12 col-md-12 col-sm-12 col-xs-12">
                <input id="mauticform_input_grailsorgconsultationform_company" name="mauticform[company]" value="" placeholder="Company" class="mauticform-input" type="text" />
                <span class="mauticform-errormsg" style="display: none;"></span>
            </div>

            <div id="mauticform_grailsorgconsultationform_submit"  class="mauticform-row mauticform-button-wrapper mauticform-field-6" style="">
                <button type="submit" name="mauticform[submit]" id="mauticform_input_grailsorgconsultationform_submit" name="mauticform[submit]" value="" class="mauticform-button btn btn-default" value="1" style="border: none; margin-left: 14px;">SUBMIT</button>
            </div>
            </div>
        </div>

        <input type="hidden" name="mauticform[formId]" id="mauticform_grailsorgconsultationform_id" value="3"/>
        <input type="hidden" name="mauticform[return]" id="mauticform_grailsorgconsultationform_return" value=""/>
        <input type="hidden" name="mauticform[formName]" id="mauticform_grailsorgconsultationform_name" value="grailsorgconsultationform"/>
</form>
</div>

<!--The code below is the message that appears when someone hits submit. Feel free to style this how you see fit for Grails.org. All CSS is handled in the above code.-->

<div class="mauticform-error" id="mauticform_grailsorgconsultationform_error"></div>
<div class="mauticform-message" id="mauticform_grailsorgconsultationform_message"></div>

<h3 style="color: #333;">The <a href="https://objectcomputing.com/products/grails/consulting-support/">OCI Grails Team</a>
includes Grails co-founders, <b>Jeff Scott Brown and Graeme Rocher</b>.
Check our <a href="https://objectcomputing.com/training/catalog/grails/">Grails courses</a> and learn from the engineers who developed,
matured and maintain Grails.</h3>

<img src="../img/ocigrailsteam.png" style="max-width: 748px; width: 100%;" alt="Grails OCI Team">

</article></div><footer>
  <div class='content'>
    <div class='ocihometograils'>
      <span>Sponsored by</span>
      <a href='https://objectcomputing.com/products/grails/'><img class='' src='../img/oci_home_to_grails.svg' alt='OCI Home to Grails' /></a>
    </div>
    <nav class='socialmedianav'><ul>
  <li>
    <a href='https://grails-slack.cfapps.io'><img class='' src='../img/slack.svg' alt='Slack Icon' /></a>
  </li>
  <li>
    <a href='https://www.youtube.com/watch?v=XnRNfDGkBVg&amp;list=PLI74De5M9T73uH3WilDCePP2qfSDpMaGu'><img class='' src='../img/youtube.svg' alt='Youtube Icon' /></a>
  </li>
  <li>
    <a href='https://www.linkedin.com/groups/39757'><img class='' src='../img/linkedin.svg' alt='LinkedIn Icon' /></a>
  </li>
  <li>
    <a href='https://github.com/grails/'><img class='' src='../img/github.svg' alt='Github Icon' /></a>
  </li>
  <li>
    <a href='https://twitter.com/grailsframework'><img class='' src='../img/twitter.svg' alt='Twitter Icon' /></a>
  </li>
</ul></nav>
    <nav class='partnersnav'><ul>
  <li>Grails' repositories are hosted by
    <a href='http://artifactoryonline.com/'>Artifactory</a>
  </li>
  <li>Website hosting provided by
    <a href='http://run.pivotal.io/'>Pivotal</a>
  </li>
  <li>YourKit supports Grails with its 
    <a href='https://www.yourkit.com/java/profiler/index.jsp'>Java Profiler</a>
  </li>
  <li>Grails is Open Source
    <a href='http://www.apache.org/licenses/LICENSE-2.0.html'>Apache 2 License</a>
  </li>
</ul></nav>
  </div>
</footer><div>
  <script type='text/javascript'>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-82213539-2', 'auto');
              ga('send', 'pageview');
</script>
  <script type='text/javascript'>
adroll_adv_id = "HBWJH4CQCJGS5DJRSB4Z4D";
adroll_pix_id = "IVEQYFOZXZAPZMDVQH7BFE";
/* OPTIONAL: provide email to improve user identification */
/* adroll_email = "username@example.com"; */
(function () {
    var _onload = function(){
        if (document.readyState && !/loaded|complete/.test(document.readyState)){setTimeout(_onload, 10);return}
        if (!window.__adroll_loaded){__adroll_loaded=true;setTimeout(_onload, 50);return}
        var scr = document.createElement("script");
        var host = (("https:" == document.location.protocol) ? "https://s.adroll.com" : "http://a.adroll.com");
        scr.setAttribute('async', 'true');
        scr.type = "text/javascript";
        scr.src = host + "/j/roundtrip.js";
        ((document.getElementsByTagName('head') || [null])[0] ||
            document.getElementsByTagName('script')[0].parentNode).appendChild(scr);
    };
    if (window.addEventListener) {window.addEventListener('load', _onload, false);}
    else {window.attachEvent('onload', _onload)}
}());            
</script>
</div></body>
</html>